## 一、Solidity 基本概念

### 1. 什么是 Solidity

- 一种受 C++、JavaScript、Python 影响的高级面向对象编程语言
- 专门用于编写可部署到 **以太坊虚拟机（EVM）** 的智能合约
- 编译器负责将 Solidity 代码编译成 EVM 可执行的字节码，并部署到区块链网络上

------

### 2. 智能合约基础结构

- **合约（contract）**：类似面向对象语言中的类，是程序模块
- **状态变量（state variable）**：永久存储在区块链上的数据
- **函数（function）**：封装可执行逻辑
- 每条语句必须以分号结尾（否则编译失败）。

------

## 二、作用域与可见性

### 1. 变量作用域

| 类型     | 存在位置           | 是否永久存储 |
| -------- | ------------------ | ------------ |
| 状态变量 | 合约内部、函数外   | 是           |
| 局部变量 | 合约内部、函数内部 | 否           |
| 全局变量 | Solidity 自动注入  | 依具体变量   |

------

### 2. 可见性说明符

| 修饰符     | 可调用范围                             |
| ---------- | -------------------------------------- |
| `public`   | 合约内部/外部、其他合约、EOA（最宽松） |
| `private`  | 只可在当前合约中访问                   |
| `internal` | 当前合约及其派生（继承）合约           |
| `external` | 只能从合约外部调用（不能内部调用）     |

**注意**：
 状态变量默认可见性为 `internal`；
 对 `public` 状态变量，编译器自动生成 Getter。

------

## 三、构造函数与生命周期

### 1. 构造函数（constructor）

- 特殊函数，只在合约创建时执行一次
- 可传入参数，初始化状态变量
- 部署后的合约字节码中不包含构造函数代码（构造代码在部署前执行完）

**执行阶段**

1. 编译
2. 构造（运行 constructor）
3. 部署到区块链
4. 区块链运行时响应交易调用执行函数逻辑

如果未显式定义，Solidity 提供默认空构造函数。

------

## 四、重要关键字（修饰符）

| 修饰符      | 作用                 |
| ----------- | -------------------- |
| `constant`  | 声明不变常量         |
| `immutable` | 构造时赋值后不可变   |
| `view`      | 只读函数，不改变状态 |
| `pure`      | 不读写状态           |
| `payable`   | 函数可接收 ETH       |

------

## 五、数据类型与内存

### 1. 原始数据类型

- `uint` / `int`：无符号/有符号整数（如 `uint256`, `int128` 等）
- 默认值依据类型而定
- 静态类型：声明时必须指定数据类型，否则不通过编译。

### 2. 值类型 vs 引用类型

- 值类型：数据按值复制
- 引用类型：数据通过引用传递（如动态数组、映射等）
- 引用 vs 值传递的区别决定函数参数如何影响内存/存储行为。

### 3. 字符串与字节

- Solidity 中字符串不是原语；字符串是动态大小的字节数组
- Solidity 没有内置浮点数（需要手动通过整数表示小数，如将数放大 10^n） 

------

## 六、数组

- 固定大小数组必须在声明时确定大小
- 动态数组可以随着 push/pop 变化大小
- 引用传递与内存位置决定复制行为与 gas 成本

------

## 七、函数修饰符（Modifiers）

- 用于复用逻辑，如前置检查、限制访问权限等
- 修饰符可被继承与重写
- 常见用于权限控制，例如仅管理员调用。

------

## 八、继承与多重继承

- Solidity 类似 OOP 支持继承
- 子合约可继承父合约的数据与函数
- 多重继承允许一个合约继承多个父合约
- 合约扁平化：编译器将继承链组合为单一合约

------

## 九、类型转换

- 显式转换可能导致数据丢失
- 隐式转换不允许，需开发者看清边界与字长
- 向大类型转换不会丢失数据，但向小类型可能丢失。

------

## 十、函数调用与 fallback

- 合约之间可以通过接口或直接导入合约调用
- fallback/receive 函数用于接收 ETH 或处理未匹配的调用
- EthersJS/Web3JS/Hardhat 可用于本地脚本调用合约。

------

## 十一、库与事件

### 库（library）

- 无状态且不可继承
- 内部函数只能是 `view` 或 `pure`
- 使用 `using Library for Type` 语法调用。

### 事件（events）

- 作为日志存储在链上
- 不能被合约调用
- 用于前端监听与链上数据索引。

------

## 十二、时间逻辑

- `block.timestamp`：交易区块时间戳
- Solidity 支持秒、分钟、小时、天、周单位
- 区块时间由矿工决定，不等同于精确现实世界时间。